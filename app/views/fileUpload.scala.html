<form id="form">
    <input type="file" name="event">
    <p>
        <input type="submit">
    </p>
</form>

<form id="addEventForm" role="form" sty>
    <div class="form-group">
        <label for="contentInput">Content</label>
        <input type="text" class="form-control" id="contentInput" placeholder="Enter content/title">
    </div>
    <div class="form-group">
        <label for="descriptionInput">Description</label>
        <textarea type="text" class="form-control" id="descriptionInput" placeholder="Enter content/title"></textarea>
    </div>
    <div>
        <label for="dateInput">Date and time</label>
        <div class="input-append date" id="newEventDatePicker" data-date-format="dd-mm-yyyy">
            <input class="span2" size="16" type="text" value="12-02-2012">
            <span class="add-on"><i class="glyphicon glyphicon-calendar"></i></span>
        </div>

        <div class="input-append bootstrap-timepicker" >
            <input id="newEventTimePicker" type="text" class="input-small">
            <span class="add-on">
                <span class="glyphicon glyphicon-time"></span>
            </span>
        </div>
    </div>
    <button type="submit">Dodaj nowy!</button>
</form>

<script type="text/javascript">

    var visDataSet;
    var timeline;

    var prepareEventData = function (json) {
        var resultDataSet = new vis.DataSet();
        var events = json.events;
        for ( var i = 0 ; i < events.length ; i++ ) {
            var event = {
                id: i,
                start: new Date(events[i].startTime),
                end: new Date(events[i].endTime),
                content: events[i].summary,
                location: events[i].location,
                description: events[i].description,
                geo: events[i].geo
            };
            resultDataSet.add(event)
        }
        return resultDataSet;
    };

    $(function (){
        $ ('#form').submit(function (e) {
            e.preventDefault( );
            data = new FormData ($( '#form' )[0]);
            $.ajax({
                type : 'POST',
                url : 'http://localhost:9000/upload',
                data : data,
                cache : false,
                contentType : false,
                processData : false
            }).done ( function ( data ) {
                var container = $("#timeline")[0];

                var preparedData = prepareEventData($.parseJSON(data));
                visDataSet = preparedData;

                var options = {};

                timeline = new vis.Timeline(container, preparedData, options);

                $("#flashing" ).text("DONE!");
            }).fail ( function ( jqXHR, status, errorThrown ) {
                console.log ( errorThrown ) ;
                console.log ( jqXHR.responseText ) ;
                console.log ( jqXHR.status ) ;
            });
        });
    });

    $(function() {
        $('#addEventForm').submit( function(e) {
            e.preventDefault( );
            console.log('Adding new event:')
            var newEventTime = $('#newEventTimePicker').data("timepicker").getTime( ).split(':');
            var newEventTimeHours = parseInt(newEventTime[0]);
            var newEventTimeMinutes = parseInt(newEventTime[1]);

            var newEvent = {
                id: 100000,
                start: $('#newEventDatePicker').datepicker('getDate' ).set({ minute: newEventTimeMinutes, hours: newEventTimeHours}),
                content: $('#contentInput' ).val(),
                description: $('#descriptionInput' ).val()
            };
            console.log(newEvent)
            addNewEventToTimeLine(visDataSet, newEvent)
        });
    });

    var addNewEventToTimeLine = function(dataSet, event) {
        dataSet.add(event);
    };

    $(function() {
        $('#newEventTimePicker').timepicker({
            showMeridian: false
        });

        $('#newEventDatePicker').datepicker({
            autoclose: true,
            weekStart: 1
        });
        $('#newEventDatePicker').datepicker('setDate', new Date());
    });

</script>